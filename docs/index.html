<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Propensity Score Matching and Subclassification in Observational Studies
    with Multi-Level Treatments • multilevelMatching</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Propensity Score Matching and Subclassification in Observational Studies
    with Multi-Level Treatments">
<meta property="og:description" content='Implements methods to estimate causal effects from observational
    studies when there are 2+ distinct levels of treatment (i.e., "multilevel
    treatment") using matching estimators, as introduced in Yang et al. (2016)
    &lt;doi:10.1111/biom.12505&gt;. Matching on covariates, and matching or 
    stratification on modeled propensity scores, are available. These methods 
    require matching on only a scalar function of generalized propensity scores.'>
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">multilevelMatching</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/multilevelMatching-v1.0.0.html">multilevelMatching-v1.0.0</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- rmarkdown v1 -->
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="multilevelmatching" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#multilevelmatching" class="anchor"></a>multilevelMatching</h1></div>

<div id="propensity-score-matching-and-subclassification-in-observational-studies-with-multi-level-treatments" class="section level3">
<h3 class="hasAnchor">
<a href="#propensity-score-matching-and-subclassification-in-observational-studies-with-multi-level-treatments" class="anchor"></a>Propensity Score Matching and Subclassification in Observational Studies with Multi-Level Treatments</h3>
<p>Installation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"shuyang1987/multilevelMatching"</span>)</code></pre></div>
</div>
<div id="visit-the-package-website" class="section level3">
<h3 class="hasAnchor">
<a href="#visit-the-package-website" class="anchor"></a>Visit the <a href="https://shuyang1987.github.io/multilevelMatching/">package website</a>
</h3>
</div>
</div>
<div id="description" class="section level1">
<h1 class="hasAnchor">
<a href="#description" class="anchor"></a>Description</h1>
<p>This package implements methods to estimate causal effects from observational studies when there are 2+ distinct levels of treatment (i.e., “multilevel treatment”) using matching estimators, as introduced in <a href="https://doi.org/10.1111/biom.12505">Yang et al. (2016) Biometrics</a>. Matching on covariates, and matching or stratification on modeled propensity scores, are made available. These methods require matching on only a scalar function of generalized propensity scores. For more information, see the Extended Description below or the main paper:</p>
<ul>
<li>Yang, S., Imbens G. W., Cui, Z., Faries, D. E., &amp; Kadziola, Z. (2016) Propensity Score Matching and Subclassification in Observational Studies with Multi-Level Treatments. <em>Biometrics</em>, 72, 1055-1065. <a href="https://doi.org/10.1111/biom.12505" class="uri">https://doi.org/10.1111/biom.12505</a>
</li>
</ul>
<p>Visit the <a href="https://shuyang1987.github.io/multilevelMatching/">package website</a></p>
</div>
<div id="estimators-available" class="section level1">
<h1 class="hasAnchor">
<a href="#estimators-available" class="anchor"></a>Estimators available</h1>
<ul>
<li>Matching on raw covariates: via <code><a href="reference/multiMatch.html">multiMatch()</a></code> and <code><a href="reference/multilevelMatchX.html">multilevelMatchX()</a></code>
</li>
<li>Matching on estimated propensity scores: via <code><a href="reference/multiMatch.html">multiMatch()</a></code> and <code><a href="reference/multilevelGPSMatch.html">multilevelGPSMatch()</a></code>
</li>
<li>using ordinal logistic regression</li>
<li>using multinomial logistic regression
<ul>
<li>This method also provides two types of variance estimates</li>
</ul>
</li>
<li>using user-provided propensity score values
<ul>
<li>This method does not provide variance estimates</li>
</ul>
</li>
<li>Stratification on propensity scores: via <code><a href="reference/multilevelGPSStratification.html">multilevelGPSStratification()</a></code>
</li>
</ul>
</div>
<div id="tutorial" class="section level1">
<h1 class="hasAnchor">
<a href="#tutorial" class="anchor"></a>Tutorial</h1>
<p>This is a brief tutorial; an extended tutorial is provided in the vignette for <a href="https://github.com/shuyang1987/multilevelMatching/releases/">version 1.0.0</a>. We will use the dataset provided with this package</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(multilevelMatching)
simulated_data &lt;-<span class="st"> </span>multilevelMatching<span class="op">::</span>simulated_data
knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(simulated_data), <span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<table class="table table">
<thead><tr class="header">
<th align="right">outcome</th>
<th align="right">treatment</th>
<th align="right">covar1</th>
<th align="right">covar2</th>
<th align="right">covar3</th>
<th align="right">covar4</th>
<th align="right">covar5</th>
<th align="right">covar6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-5.13</td>
<td align="right">1</td>
<td align="right">-0.87</td>
<td align="right">0.24</td>
<td align="right">0.23</td>
<td align="right">-2.89</td>
<td align="right">0.21</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">-3.03</td>
<td align="right">1</td>
<td align="right">0.27</td>
<td align="right">-0.35</td>
<td align="right">-0.40</td>
<td align="right">-2.21</td>
<td align="right">0.07</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">3.05</td>
<td align="right">1</td>
<td align="right">1.42</td>
<td align="right">1.32</td>
<td align="right">-1.20</td>
<td align="right">0.06</td>
<td align="right">1.26</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">-6.09</td>
<td align="right">1</td>
<td align="right">-1.39</td>
<td align="right">-1.07</td>
<td align="right">1.12</td>
<td align="right">-2.36</td>
<td align="right">0.00</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">-2.46</td>
<td align="right">1</td>
<td align="right">-1.15</td>
<td align="right">0.95</td>
<td align="right">0.51</td>
<td align="right">-2.68</td>
<td align="right">0.07</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">-0.32</td>
<td align="right">1</td>
<td align="right">0.27</td>
<td align="right">0.42</td>
<td align="right">-0.45</td>
<td align="right">2.43</td>
<td align="right">0.60</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>We restructure the dataframe slightly, and use identifying names for the observations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">outcome &lt;-<span class="st"> </span>simulated_data<span class="op">$</span>outcome
treatment &lt;-<span class="st"> </span>simulated_data<span class="op">$</span>treatment
covar_matrix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(
  simulated_data[ ,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(simulated_data) <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"covar"</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)]
)
identifying_names &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">25</span>],<span class="dt">each =</span> <span class="dv">12</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">25</span>], <span class="dv">12</span>)
)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(treatment) &lt;-<span class="st"> </span>identifying_names</code></pre></div>
<div id="matching-on-covariates" class="section level2">
<h2 class="hasAnchor">
<a href="#matching-on-covariates" class="anchor"></a>Matching on covariates</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)
fit &lt;-<span class="st"> </span><span class="kw"><a href="reference/multiMatch.html">multiMatch</a></span>(
  <span class="dt">Y =</span> outcome,
  <span class="dt">W =</span> treatment,
  <span class="dt">X =</span> covar_matrix,
  <span class="dt">match_on =</span> <span class="st">"covariates"</span>
)

fit
<span class="co">#&gt; -------------- Causal estimates ---------------</span>
<span class="co">#&gt;         Param Trt1 Trt2   Estimate  Variance</span>
<span class="co">#&gt; 1 EY(2)-EY(1)    1    2 0.07927361 0.1792186</span>
<span class="co">#&gt; 2 EY(3)-EY(1)    1    3 0.86264929 0.1634754</span>
<span class="co">#&gt; 3 EY(3)-EY(2)    2    3 0.78337567 0.3221616</span>
<span class="co">#&gt; --- Matching on 'covariates' with M=1, J=1 ---</span></code></pre></div>
</div>
<div id="matching-on-the-estimated-generalized-propensity-score-gps" class="section level2">
<h2 class="hasAnchor">
<a href="#matching-on-the-estimated-generalized-propensity-score-gps" class="anchor"></a>Matching on the Estimated Generalized Propensity Score (GPS)</h2>
<p>Propensity scores can be estimated with either of the following options</p>
<ul>
<li>
<code>match_on="multinom"</code> for multinomial logistic regression from <code><a href="https://www.rdocumentation.org/packages/nnet/topics/multinom">nnet::multinom()</a></code>
</li>
<li>
<code>match_on="polr"</code> for ordinal logistic regression from <code><a href="https://www.rdocumentation.org/packages/MASS/topics/polr">MASS::polr()</a></code>
</li>
<li>Or, estimated propensity scores can be supplied via the <code>X</code> argument when <code>match_on="existing"</code>
</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">match_on &lt;-<span class="st"> "multinom"</span>
<span class="co"># match_on &lt;- "polr" </span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)
fit2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/multiMatch.html">multiMatch</a></span>(
  <span class="dt">Y =</span> outcome,
  <span class="dt">W =</span> treatment,
  <span class="dt">X =</span> covar_matrix,
  <span class="dt">match_on =</span> match_on,
  <span class="dt">trimming =</span> <span class="ot">FALSE</span>
)

fit
<span class="co">#&gt; -------------- Causal estimates ---------------</span>
<span class="co">#&gt;         Param Trt1 Trt2   Estimate  Variance</span>
<span class="co">#&gt; 1 EY(2)-EY(1)    1    2 0.07927361 0.1792186</span>
<span class="co">#&gt; 2 EY(3)-EY(1)    1    3 0.86264929 0.1634754</span>
<span class="co">#&gt; 3 EY(3)-EY(2)    2    3 0.78337567 0.3221616</span>
<span class="co">#&gt; --- Matching on 'covariates' with M=1, J=1 ---</span></code></pre></div>
<p>Please see the vignette for an extended tutorial.</p>
</div>
</div>
<div id="extended-description" class="section level1">
<h1 class="hasAnchor">
<a href="#extended-description" class="anchor"></a>Extended Description</h1>
<div id="matching-with-3-or-more-levels-of-treatment" class="section level2">
<h2 class="hasAnchor">
<a href="#matching-with-3-or-more-levels-of-treatment" class="anchor"></a>Matching with 3 or more levels of treatment</h2>
<p>In setting with where 3 or more levels of treatment (i.e., multilevel treatment), our goal is to estimate pairwise average treatment effects from a common population using matching methods.</p>
<p>This goal can not be acheived by matching one treatment with another one at a time, since the pairwise matched samples may differ from the target population systematically, and thus they are not compatitable. One implication is that from this approach, it is possible that treatment A is better than treatment B, treatment B is better than treatment C, and treatment C is better than treatment A.</p>
<p>We focus on estimating the average values of potential outcomes for each treatment level by matching methods, which facilitate estimation of pairwise average treatment effects for a common population.</p>
<p>The estimation methods include generalized propensity score (GPS) matching, GPS stratification, matching with the full set of covariates, matching with the full set of GPS vector. Note that GPS matching and GPS straticication only require matching on a scalar function when estimating the average value of the potential outcome at a particular treatment level, which reduces the matching dimension to one, regardless of the number of covariates and the number of treatment levels.</p>
<p>In order to ensure sufficient overlap, <a href="https://doi.org/10.1093/biomet/asn055">Crump et al. (2009)</a>’s trimming method can be extended to this setting as well.</p>
</div>
</div>
<div id="news" class="section level1">
<h1 class="hasAnchor">
<a href="#news" class="anchor"></a>News</h1>
<p>See <a href="https://shuyang1987.github.io/multilevelMatching/news/index.html">the News site</a> for the changelog.</p>
<div id="a-note-on-multimatch" class="section level4">
<h4 class="hasAnchor">
<a href="#a-note-on-multimatch" class="anchor"></a>A note on <code><a href="reference/multiMatch.html">multiMatch()</a></code>
</h4>
<p>The <code><a href="reference/multiMatch.html">multiMatch()</a></code> function may return slightly different estimates than the original 2 matching functions in certain circumstances. We attempt to ensure that the functions implement are identical methods up to perhaps random number generation. Please file an issue if you have any questions or concerns.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Report a bug at <br><a href="https://github.com/shuyang1987/multilevelMatching/issues">https://​github.com/​shuyang1987/​multilevelMatching/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Shu Yang <br><small class="roles"> Author </small>  </li>
<li>Brian G. Barkley <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1787-4735" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID" height="16"></a> </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=multilevelMatching"><img src="http://www.r-pkg.org/badges/version/multilevelMatching" alt="CRAN_Status_Badge"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#stable"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="lifecycle"></a></li>
<li><a href="https://travis-ci.org/shuyang1987/multilevelMatching"><img src="https://travis-ci.org/shuyang1987/multilevelMatching.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/BarkleyBG/multilevelmatching-3hh85"><img src="https://ci.appveyor.com/api/projects/status/eu7vlcbu2j854cdo?svg=true" alt="AppveyorCI Build status"></a></li>
<li><a href="https://codecov.io/github/shuyang1987/multilevelMatching?branch=master"><img src="https://codecov.io/gh/shuyang1987/multilevelMatching/branch/master/graph/badge.svg" alt="Coverage status"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Shu Yang, Brian G. Barkley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
